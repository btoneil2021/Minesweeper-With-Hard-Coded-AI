# UI Bar Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Add a 3-row UI bar above the game board to display win rate, game mode, and reserve space for future UI elements without overlaying the game board.

**Architecture:** Create dedicated UIBar class for managing multi-row layout, update RenderManager to integrate UIBar at top of screen, adjust screen size to accommodate bar while keeping game board at full size.

**Tech Stack:** Python 3, pygame

---

## Task 1: Add UI Bar Configuration Constants

**Files:**
- Modify: `Minesweeper/config.py`
- Modify: `Minesweeper/constants.py`

**Step 1: Add UI_ROW_HEIGHT to config.py**

Add after FONT_SIZE (line 13):

```python
UI_ROW_HEIGHT = 30     # Height of each UI bar row in pixels
```

**Step 2: Add derived UI constants to constants.py**

Add after COLOR_BLACK (line 26):

```python
# UI Bar
UI_BAR_HEIGHT = UI_ROW_HEIGHT * 3  # Total UI bar height (3 rows)
UI_BAR_COLOR = (200, 200, 200)     # Light gray background
```

**Step 3: Update SCREEN_SIZE calculation in constants.py**

Replace line 5:

```python
# Before:
SCREEN_SIZE = (TILE_SIZE * NUM_TILES_X, TILE_SIZE * NUM_TILES_Y)

# After:
SCREEN_SIZE = (TILE_SIZE * NUM_TILES_X, TILE_SIZE * NUM_TILES_Y + UI_BAR_HEIGHT)
```

**Step 4: Verify constants are imported correctly**

Run: `cd Minesweeper && python -c "from constants import UI_BAR_HEIGHT, UI_BAR_COLOR; print(f'UI_BAR_HEIGHT={UI_BAR_HEIGHT}, UI_BAR_COLOR={UI_BAR_COLOR}')"`

Expected output: `UI_BAR_HEIGHT=90, UI_BAR_COLOR=(200, 200, 200)`

**Step 5: Commit configuration changes**

```bash
git add Minesweeper/config.py Minesweeper/constants.py
git commit -m "feat: add UI bar configuration constants

Add UI_ROW_HEIGHT config and derived UI_BAR_HEIGHT/UI_BAR_COLOR.
Update SCREEN_SIZE to include UI bar height.

 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

## Task 2: Create UIBar Class

**Files:**
- Create: `Minesweeper/game/ui_bar.py`
- Modify: `Minesweeper/game/__init__.py`

**Step 1: Create ui_bar.py with UIBar class**

Create `Minesweeper/game/ui_bar.py`:

```python
import pygame as py
from constants import UI_ROW_HEIGHT, UI_BAR_COLOR, COLOR_BLACK


class UIBar:
    """Manages a multi-row UI bar for displaying game information."""

    def __init__(self, width, font, num_rows=3):
        """Initialize UI bar with specified width and number of rows.

        Args:
            width: Width of the bar in pixels
            font: pygame.font.Font instance for rendering text
            num_rows: Number of rows in the bar (default: 3)
        """
        self.width = width
        self.font = font
        self.num_rows = num_rows
        self.height = UI_ROW_HEIGHT * num_rows
        self.row_contents = [None] * num_rows  # Store (text, alignment) tuples

    def set_row_content(self, row_index, text, alignment='left'):
        """Set content for a specific row.

        Args:
            row_index: Row number (0-based, must be < num_rows)
            text: Text to display
            alignment: 'left', 'center', or 'right'

        Raises:
            ValueError: If row_index is out of range
        """
        if row_index < 0 or row_index >= self.num_rows:
            raise ValueError(f"row_index must be 0-{self.num_rows-1}, got {row_index}")

        self.row_contents[row_index] = (text, alignment)

    def render(self):
        """Render the UI bar and return as a pygame surface.

        Returns:
            pygame.Surface with the rendered UI bar
        """
        surface = py.Surface((self.width, self.height))
        surface.fill(UI_BAR_COLOR)

        for row_index, content in enumerate(self.row_contents):
            if content is None:
                continue  # Skip empty rows

            text, alignment = content
            text_surface = self.font.render(text, True, COLOR_BLACK)

            # Calculate vertical position (center text in row)
            y_pos = row_index * UI_ROW_HEIGHT + (UI_ROW_HEIGHT - text_surface.get_height()) // 2

            # Calculate horizontal position based on alignment
            if alignment == 'left':
                x_pos = 10  # 10px left padding
            elif alignment == 'center':
                x_pos = (self.width - text_surface.get_width()) // 2
            elif alignment == 'right':
                x_pos = self.width - text_surface.get_width() - 10  # 10px right padding
            else:
                x_pos = 10  # Default to left

            surface.blit(text_surface, (x_pos, y_pos))

        return surface
```

**Step 2: Export UIBar from game package**

Modify `Minesweeper/game/__init__.py`, add UIBar to imports (line 4):

```python
# Before:
from .render_manager import RenderManager

# After:
from .render_manager import RenderManager
from .ui_bar import UIBar
```

Update __all__ list at the bottom:

```python
__all__ = ['Board', 'GameLogic', 'RenderManager', 'StatisticsTracker', 'UIBar']
```

**Step 3: Verify UIBar imports correctly**

Run: `cd Minesweeper && python -c "from game import UIBar; print('UIBar imported successfully')"`

Expected output: `UIBar imported successfully`

**Step 4: Commit UIBar class**

```bash
git add Minesweeper/game/ui_bar.py Minesweeper/game/__init__.py
git commit -m "feat: create UIBar class for multi-row UI layout

Add UIBar class with configurable rows, text alignment support,
and pygame surface rendering.

 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

## Task 3: Update RenderManager to Use UIBar

**Files:**
- Modify: `Minesweeper/game/render_manager.py`

**Step 1: Import UIBar and UI_BAR_HEIGHT**

Add to imports at top of file (after line 2):

```python
from constants import *
from .ui_bar import UIBar
```

**Step 2: Initialize UIBar in RenderManager.__init__**

Modify `__init__` method (after line 9):

```python
def __init__(self, screen_size, font_size=30):
    self.screen = py.display.set_mode(screen_size)
    self.font = py.font.Font(None, font_size)
    self.ui_bar = UIBar(screen_size[0], self.font)
```

**Step 3: Update render method to use UIBar**

Replace the entire `render` method (lines 11-26):

```python
def render(self, board, win_rate: float, game_mode=None, ai_enabled=None):
    """Draw the UI bar and game board."""
    self.screen.fill(COLOR_WHITE)

    # Populate UI bar rows
    self.ui_bar.set_row_content(0, f"Win Rate: {win_rate:.2%}", alignment='left')

    if game_mode is not None:
        mode_text = self._get_mode_text(game_mode, ai_enabled)
        self.ui_bar.set_row_content(1, mode_text, alignment='left')

    # Row 2 is reserved for future use (left empty)

    # Render UI bar at top
    ui_bar_surface = self.ui_bar.render()
    self.screen.blit(ui_bar_surface, (0, 0))

    # Render board below UI bar
    board.draw(self.screen, y_offset=UI_BAR_HEIGHT)

    py.display.update()
```

**Step 4: Check if Board.draw accepts y_offset parameter**

Run: `cd Minesweeper && python -c "import inspect; from game import Board; sig = inspect.signature(Board.draw); print(sig)"`

Expected: See the signature of Board.draw method

**Step 5: Commit RenderManager updates**

```bash
git add Minesweeper/game/render_manager.py
git commit -m "feat: integrate UIBar into RenderManager

Update RenderManager to use UIBar for displaying win rate and mode.
Position board below UI bar using y_offset parameter.

 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

## Task 4: Update Board.draw to Support Y-Offset

**Files:**
- Modify: `Minesweeper/game/board.py`

**Note:** This task may need adjustment based on current Board.draw signature discovered in Task 3, Step 4.

**Step 1: Read current Board.draw implementation**

Run: `cd Minesweeper && grep -A 20 "def draw" game/board.py`

**Step 2: Add y_offset parameter to Board.draw**

Modify the `draw` method signature to accept optional y_offset parameter:

```python
def draw(self, screen, y_offset=0):
    """Draw the board on the screen.

    Args:
        screen: pygame surface to draw on
        y_offset: Vertical offset in pixels (default: 0)
    """
```

**Step 3: Update all drawing coordinates to use y_offset**

When drawing tiles, add y_offset to the y-coordinate calculations:

```python
# Example pattern - adjust based on actual implementation:
# Before:
rect = py.Rect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE)

# After:
rect = py.Rect(x * TILE_SIZE, y * TILE_SIZE + y_offset, TILE_SIZE, TILE_SIZE)
```

Apply this pattern to all drawing operations (rectangles, text, images).

**Step 4: Test the game visually**

Run: `cd Minesweeper && python -m game_runner`

Expected:
- Window opens at 800x890 pixels (800x800 board + 90px UI bar)
- UI bar visible at top with light gray background
- Win rate displayed in row 0
- Game mode displayed in row 1
- Row 2 empty
- Game board positioned below UI bar with no overlay

**Step 5: Commit Board.draw changes**

```bash
git add Minesweeper/game/board.py
git commit -m "feat: add y_offset support to Board.draw

Allow board to be positioned with vertical offset for UI bar integration.

 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

## Task 5: Cleanup and Final Verification

**Files:**
- None (verification only)

**Step 1: Test AI-only mode**

Run game with AI-only mode and verify UI bar displays correctly:

```bash
cd Minesweeper
python -m game_runner
# Select mode 0 when prompted
```

Verify:
- Win rate updates as games complete
- Mode displays "Mode: AI Only"
- No text overlay on game board

**Step 2: Test Player-only mode**

Run game with player-only mode:

```bash
cd Minesweeper
python -m game_runner
# Select mode 1 when prompted
```

Verify:
- Win rate displays (likely 0.00% initially)
- Mode displays "Mode: Player Only"
- Can click tiles normally
- Board properly positioned below UI bar

**Step 3: Test Hybrid mode**

Run game with hybrid mode:

```bash
cd Minesweeper
python -m game_runner
# Select mode 2 when prompted
```

Verify:
- Mode displays "Mode: Hybrid | AI: ON" or "AI: OFF"
- Toggling AI with SPACE updates the display
- UI bar updates in real-time

**Step 4: Check for any remaining issues**

Review visual appearance:
- [ ] UI bar has light gray background (200, 200, 200)
- [ ] Text is left-aligned with appropriate padding
- [ ] Text is vertically centered in each row
- [ ] Row 2 is empty but allocated
- [ ] No overlay between UI bar and game board
- [ ] Window size is correct (800x890 with default config)

**Step 5: Final commit if any adjustments needed**

If tweaks were made during testing:

```bash
git add -A
git commit -m "fix: adjust UI bar styling and positioning

Final adjustments based on visual testing.

 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

---

## Completion Checklist

After all tasks complete:

- [ ] All commits made with descriptive messages
- [ ] Game runs without errors
- [ ] UI bar displays at top of window
- [ ] Win rate and game mode visible without overlay
- [ ] Row 2 reserved for future use
- [ ] All three game modes tested
- [ ] Screen size increased appropriately
- [ ] Board positioned correctly below UI bar

**Next Steps:**
1. Use @superpowers:finishing-a-development-branch to complete the work
2. Choose merge strategy (direct merge vs PR)
3. Clean up worktree

---

## Notes

**Design Decisions:**
- Fixed 3 rows for simplicity (can be made configurable later if needed)
- Uniform row height (30px) for visual consistency
- Left alignment default for status information
- Light gray background to distinguish from game board

**Future Extensions:**
- To add content to row 2: Call `ui_bar.set_row_content(2, "text", alignment)`
- To add more rows: Modify UIBar initialization to accept different num_rows
- To add interactive elements: Extend UIBar with button/widget support
